{% extends 'base.html' %}
{% load static %}

{% block title %}Premium Formal Shirt{% endblock title %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/products/product_detail.css' %}">
{% endblock extra_styles %}

{% block content %}
<div class="product-detail-container">
    
    <div class="product-gallery">
     <div class="gallery-main img-zoom-container">
         <img src="{{product.image}}" alt="{{product.name}}" id="main-product-image">
     </div>
     <div id="zoom-result" class="img-zoom-result"></div>
     <div class="gallery-thumbnails">
         {% for image in images_list_limited %}
         <img src="{{image.image_url}}" alt="Thumbnail 1" class="thumbnail-img" data-image="{{image.image_url}}">
         {% endfor %}
     </div>
 </div>

    <div class="product-info">
        <h1>{{product.name}}</h1>
        <p class="price">â‚¹ {{product.price}}</p>
        
        <div class="product-options">
            
             <div class="option-group">
                <div class="option-header">
                    <span><strong>Size:</strong></span>
                    <span id="selected-size"></span> 
                </div>
                <div class="option-buttons size-buttons">
                    {% for size in sizes %}
                        <button class="btn-size" data-size="{{size}}">{{size}}</button>
                    {% endfor %}
                </div>
            </div>

            {% comment %} ... your commented-out color options ... {% endcomment %}

            <div class="option-group">
                <label for="quantity-display" class="quantity-label"><strong>Quantity</strong></label>
                <div class="quantity-selector">
                    <button class="btn-quantity" id="btn-decrease" aria-label="Decrease quantity"><i class='bx bx-minus'></i></button>
                    <span id="quantity-display">1 item</span>
                    <button class="btn-quantity" id="btn-increase" aria-label="Increase quantity"><i class='bx bx-plus'></i></button>
                </div>
            </div>

        </div>

        <div class="action-buttons">
            <button class="btn btn-outline">Add to Cart</button>
            <button class="btn btn-solid">Buy Now</button>
        </div>

        <div class="secondary-actions">
            <a href="#" class="action-link">
                <i class='bx bx-heart'></i>
                <span>Add to Wishlist</span>
            </a>
            <a href="#" class="action-link">
                <i class='bx bx-share' ></i>
                <span>Share</span>
            </a>
        </div>

        <br>
        <details class="description-accordion">
            <summary class="description-header">
                Description
            </summary>
            <div class="description-content">
                {{product.description|linebreaks}}
            </div>
        </details>

    </div>
</div>
{% endblock content %}

{% block extra_script %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ... your thumbnail switcher code ...
        const mainImage = document.getElementById('main-product-image');
        const thumbnails = document.querySelectorAll('.thumbnail-img');

        thumbnails.forEach(thumb => {
            thumb.addEventListener('click', function() {
                mainImage.src = this.dataset.image;
                thumbnails.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });


        // Size selector
        const sizeButtons = document.querySelectorAll('.btn-size');
        const selectedSize = document.getElementById('selected-size');

        sizeButtons.forEach(button => {
            button.addEventListener('click', function() {
                sizeButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // SAFETY CHECK: Only update if the element exists
                if (selectedSize) { 
                    selectedSize.textContent = this.dataset.size;
                }
            });
        });

        // ... your color selector code (commented) ...

        // ... your quantity selector code ...
        const decreaseBtn = document.getElementById('btn-decrease');
        const increaseBtn = document.getElementById('btn-increase');
        const quantityDisplay = document.getElementById('quantity-display');
        let quantity = 1;
        const maxQuantity = 5; // Maximum allowed per person

        function updateDisplay() {
            quantityDisplay.textContent = `${quantity} ${quantity === 1 ? 'item' : 'items'}`;
            decreaseBtn.disabled = quantity === 1;
            increaseBtn.disabled = quantity === maxQuantity;
        }

        decreaseBtn.addEventListener('click', function() {
            if (quantity > 1) {
                quantity--;
                updateDisplay();
            }
        });

        increaseBtn.addEventListener('click', function() {
            if (quantity < maxQuantity) {
                quantity++;
                updateDisplay();
            }
        });

        updateDisplay();

    });
    document.addEventListener('DOMContentLoaded', function() {
     // ... (your existing thumbnail and quantity code) ...
 
     const galleryMain = document.querySelector('.gallery-main');
     const mainImage = document.getElementById('main-product-image');
 
     galleryMain.addEventListener('mousemove', function(e) {
         const rect = galleryMain.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
    
            const xPercent = (x / rect.width) * 100;
            const yPercent = (y / rect.height) * 100;
    
            mainImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
        });
    
        // Reset the zoom origin when the mouse leaves
        galleryMain.addEventListener('mouseleave', function() {
            mainImage.style.transformOrigin = 'center center';
        });
    });
</script>
{% endblock extra_script %}